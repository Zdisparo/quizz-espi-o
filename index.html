<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Quiz — Sinais no Relacionamento</title>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
<style>
  :root{
    --content-max: 640px; --card-max: 520px; --img-min: 160px; --img-max: 220px;
    --bg:#ffffff; --text:#111827; --muted:#6b7280; --line:#e5e7eb;
    --accent1:#22c55e; --accent2:#0ea5e9; --shadow:0 10px 24px rgba(0,0,0,.06); --radius:14px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:15px/1.5 "Inter",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif}
  .wrap{max-width:var(--content-max);margin:22px auto;padding:0 14px}

  .brand{display:flex;flex-direction:column;align-items:center;gap:10px}
  .logo{width:48px;height:48px;border-radius:12px;display:grid;place-items:center;background:#111;color:#fff;font-weight:900;box-shadow:var(--shadow);font-size:14px}
  .progress{width:100%;height:6px;border-radius:999px;background:#f3f4f6;margin:12px 0 10px;overflow:hidden;border:1px solid var(--line)}
  .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent1),var(--accent2));transition:width .25s ease}

  .callout{display:flex;align-items:center;gap:8px;justify-content:center;color:#065f46;background:#ecfdf5;border:1px solid #a7f3d0;
           font-weight:700;border-radius:10px;padding:8px 10px;margin:6px auto 12px;width:fit-content;max-width:100%}
  .callout .icon{font-weight:900}

  .stage{display:grid;gap:10px;place-items:center}

  /* títulos das perguntas – evidentes */
  .badge{
    display:inline-flex;align-items:center;gap:8px;background:#eef2ff;color:#1e3a8a;border:1px solid #c7d2fe;
    padding:6px 10px;border-radius:999px;font-weight:900;font-size:.8rem;margin:6px auto 2px
  }
  .title{font-size:1.35rem;font-weight:900;text-align:center;margin:4px 0 2px}
  .hint{color:#111827;text-align:center;margin:0 0 10px;font-size:1rem;font-weight:600}

  /* cards */
  .qcard{width:100%;max-width:var(--card-max);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;background:#fff;cursor:pointer;transition:transform .08s ease}
  .qcard:hover{transform:translateY(-1px)}
  .qimg{width:100%;height:clamp(var(--img-min), 22vw, var(--img-max));object-fit:cover;background:#f3f4f6}
  .qfoot{background:#0b1220;color:#f9fafb;padding:10px 12px;display:flex;align-items:center;justify-content:space-between;gap:8px}
  .qtitle{font-weight:900;font-size:.98rem}
  .qnote{opacity:.85;font-size:.85rem}
  .radio{width:18px;height:18px;border-radius:50%;border:2px solid #cbd5e1;background:#0b1220}

  /* pills */
  .pill{width:100%;max-width:var(--card-max);display:flex;align-items:center;gap:10px;border:2px solid #111827;border-radius:12px;padding:12px 14px;background:#fff;box-shadow:var(--shadow);cursor:pointer}
  .pill:hover{transform:translateY(-1px)}
  .dot{width:10px;height:10px;border-radius:50%;background:#111827}
  .pill b{font-weight:900;font-size:1rem}

  /* inputs de nome */
  .ibox{width:100%;max-width:var(--card-max);display:grid;gap:8px;border:1px solid var(--line);border-radius:12px;background:#fff;box-shadow:var(--shadow);padding:14px}
  .ibox label{font-weight:900}
  .itxt{width:100%;border:2px solid #111827;border-radius:10px;padding:12px 12px;font-size:1rem}
  .ibtn{justify-self:end;border:0;border-radius:10px;padding:10px 14px;background:#111827;color:#fff;font-weight:900;cursor:pointer}

  /* resultado */
  .result{display:none;gap:10px}
  .rez{border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:12px;background:#fff}
  .rez h3{margin:0 0 6px;font-size:1.05rem}
  .meter{height:12px;background:#f3f4f6;border:1px solid var(--line);border-radius:999px;overflow:hidden}
  .fill{height:100%;width:0%;background:linear-gradient(90deg,#22c55e,#f59e0b,#ef4444);transition:width .45s ease}
  .tag{display:inline-block;padding:5px 8px;border-radius:999px;font-weight:900;margin:6px 0 0;font-size:.85rem}
  .low{background:#ecfdf5;color:#065f46}
  .mid{background:#fffbeb;color:#92400e}
  .high{background:#fef2f2;color:#991b1b}

  /* CTA App */
  .cta{display:grid;place-items:center;text-align:center}
  .cta p{margin:4px 0 8px}
  .cta-btn{border:0;background:#111827;color:#fff;font-weight:900;padding:12px 18px;border-radius:12px;cursor:pointer;box-shadow:var(--shadow)}
  .cta-btn:hover{transform:translateY(-1px)}
  
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:#111827;color:#fff;padding:8px 12px;border-radius:10px;display:none;box-shadow:var(--shadow);font-size:.92rem}
  .toast.show{display:block}
</style>
</head>
<body>
  <div class="wrap">
    <div class="brand">
      <div class="logo">QZ</div>
      <div class="progress"><div id="bar" class="bar"></div></div>
    </div>

    <div class="callout"><span class="icon">✔</span> VOCÊ GANHOU 1 ACESSO GRÁTIS!</div>

    <div id="stage" class="stage"></div>

    <div id="result" class="result">
      <div class="rez">
        <h3>Seu panorama</h3>
        <div id="rezTag" class="tag low">Baixo</div>
        <div style="margin:6px 0 4px;color:#6b7280">Intensidade percebida dos sinais</div>
        <div class="meter"><div id="fill" class="fill"></div></div>
        <p id="rezText" style="margin:8px 0 0"></p>
      </div>

      <div class="rez cta">
        <p id="ctaText">
          Quer organizar tudo e receber orientações <b>seguras e legais</b>? Conheça nosso app.
        </p>
        <button id="ctaApp" class="cta-btn">Conhecer o app</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast">Preencha para continuar.</div>

<script>
/* ========================
   CONFIG CTA
   ======================== */
const APP_URL = "https://espi-o.onrender.com"; // coloque o link do seu app aqui

/* ===== Estado ===== */
let current = 0;
let answers = {};
let who = "parceiro(a)";
let userName = "";
let partnerName = "";

/* ===== DOM ===== */
const stage = document.getElementById('stage');
const bar = document.getElementById('bar');
const result = document.getElementById('result');
const rezTag = document.getElementById('rezTag');
const rezText = document.getElementById('rezText');
const fill = document.getElementById('fill');
const toast = document.getElementById('toast');

/* ===== Helpers ===== */
function showToast(m){ toast.textContent=m; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),1200); }
function escapeHtml(str){ return str.replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* ===== Perguntas =====
   Ordem: 0 who → 1 nameUser → 2 namePartner → 3..12 perguntas */
const QUESTIONS = [
  {
    type:"who",
    options:[
      { id:"parceiro", img:"https://images.unsplash.com/photo-1599566150163-29194dcaad36?w=700&auto=format&fit=crop", label:"Quero avaliar sinais no meu parceiro (marido/namorado)", note:"Imagem por I.A" },
      { id:"parceira", img:"https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=700&auto=format&fit=crop", label:"Quero avaliar sinais na minha parceira (esposa/namorada)", note:"Imagem por I.A" }
    ]
  },
  { type:"nameUser" },
  { type:"namePartner" },  
  { title:"Novos segredos digitais apareceram?",
    sub:"Senha trocada sem comentar, celular sempre virado pra baixo.",
    options:[{score:2,text:"Sim, bem mais secreto(a)"},{score:1,text:"Um pouco mais discreto(a)"},{score:0,text:"Não notei mudança"}] },
  { title:"Rotina e disponibilidade mudaram abruptamente?",
    sub:"Chegadas mais tarde, justificativas vagas.",
    options:[{score:2,text:"Mudou muito e de repente"},{score:1,text:"Mudou um pouco"},{score:0,text:"Permanece parecida"}] },
  { title:"Intimidade/afeto oscila sem explicação?",
    sub:"Distância e superatenção alternando.",
    options:[{score:2,text:"Oscila bastante"},{score:1,text:"Leve oscilação"},{score:0,text:"Nada fora do comum"}] },
  { title:"Defensividade quando você pergunta coisas simples?",
    sub:"Respostas ríspidas do tipo: ‘Por que quer saber?’",
    options:[{score:2,text:"Com frequência"},{score:1,text:"Às vezes"},{score:0,text:"Quase nunca"}] },
  { title:"Histórias com detalhes inconsistentes?",
    sub:"Horários/detalhes não batem ao recontar.",
    options:[{score:2,text:"Direto"},{score:1,text:"Raramente"},{score:0,text:"Não notei"}] },
  { title:"Mudanças em autocuidado/estilo sem motivo claro?",
    sub:"Cheiros novos, roupas específicas para ‘certas saídas’.",
    options:[{score:2,text:"Mudou bastante"},{score:1,text:"Um pouco"},{score:0,text:"Nada relevante"}] },
  { title:"Limites de privacidade viraram ‘segredo’?",
    sub:"Pânico se o celular fica desbloqueado por perto.",
    options:[{score:2,text:"Sim, ficou secreto"},{score:1,text:"Ficou reservado"},{score:0,text:"Privacidade normal"}] },
  { title:"Pessoas novas surgiram de repente com muita presença?",
    sub:"Contatos frequentes que você mal conhece.",
    options:[{score:2,text:"Sim, muito presentes"},{score:1,text:"Alguns, às vezes"},{score:0,text:"Nada fora do normal"}] },
  { title:"Planos cancelados de última hora com justificativa vaga?",
    sub:"‘Imprevistos’ repetidos.",
    options:[{score:2,text:"Bastante"},{score:1,text:"Ocasionalmente"},{score:0,text:"Quase nunca"}] }
];

function steps(){ return QUESTIONS.length; }

/* ===== Render ===== */
function render(){
  stage.innerHTML = "";
  result.style.display = "none";

  const q = QUESTIONS[current];

  if(q.type === "who"){
    addTitles("Selecione sobre quem você tem dúvidas:", "Escolha uma opção abaixo (imagem pode ser gerada por I.A)");
    q.options.forEach(o=>{
      const card=document.createElement('div');
      card.className="qcard"; card.tabIndex=0;
      card.innerHTML=`
        <img class="qimg" src="${o.img}" alt="${o.label}" loading="lazy"/>
        <div class="qfoot">
          <div>
            <div class="qtitle">${o.label}</div>
            <div class="qnote">${o.note||""}</div>
          </div>
          <div class="radio"></div>
        </div>`;
      card.addEventListener('click', ()=>{
        who = o.id === "parceira" ? "parceira" : "parceiro";
        answers[current]={score:0,choice:o.id};
        autoNext();
      });
      stage.appendChild(card);
    });
  } else if(q.type === "nameUser"){
    renderNameBox({
      label:"Seu nome",
      placeholder:"Digite seu nome",
      onSubmit:(val)=>{
        userName = val.trim();
        if(!userName){ showToast("Digite seu nome."); return; }
        autoNext();
      }
    });
  } else if(q.type === "namePartner"){
    const label = who === "parceira" ? "Nome da parceira" : "Nome do parceiro";
    renderNameBox({
      label,
      placeholder: who === "parceira" ? "Ex.: Ana" : "Ex.: João",
      onSubmit:(val)=>{
        partnerName = val.trim();
        if(!partnerName){ showToast(`Digite o nome ${who==='parceira'?'da parceira':'do parceiro'}.`); return; }
        autoNext();
      }
    });
  } else {
    addTitles(q.title, q.sub);
    q.options.forEach(o=>{
      const pill=document.createElement('div');
      pill.className="pill";
      pill.innerHTML=`<span class="dot"></span><b>${o.text}</b>`;
      pill.addEventListener('click', ()=>{ answers[current]={score:o.score,choice:o.text}; autoNext(); });
      stage.appendChild(pill);
    });
  }

  const pct = Math.round((current)/(steps()-1)*100);
  bar.style.width = Math.max(4,pct)+"%";
}

function addTitles(t, s){
  const b=document.createElement('div');
  b.className="badge"; b.innerHTML="📋 <span>PERGUNTA</span>";
  stage.appendChild(b);
  if(t){
    const titleEl=document.createElement('div');
    titleEl.className="title";
    titleEl.textContent=t;
    stage.appendChild(titleEl);
  }
  if(s){
    const hint=document.createElement('div');
    hint.className="hint";
    hint.textContent=s;
    stage.appendChild(hint);
  }
}

function renderNameBox({label,placeholder,onSubmit}){
  const box=document.createElement('div');
  box.className="ibox";
  box.innerHTML=`
    <label>${label}</label>
    <input id="itxt" class="itxt" type="text" placeholder="${placeholder}" />
    <button id="ibtn" class="ibtn">Continuar ▶</button>
  `;
  stage.appendChild(box);
  const itxt=box.querySelector('#itxt'); const ibtn=box.querySelector('#ibtn');
  function go(){ onSubmit(itxt.value); }
  ibtn.addEventListener('click', go);
  itxt.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); go(); } });
  setTimeout(()=>itxt.focus(), 50);
}

function autoNext(){ setTimeout(()=>{ current<steps()-1 ? (current++,render()) : showResult(); }, 180); }

/* ===== Resultado ===== */
function showResult(){
  let sum=0,max=0;
  QUESTIONS.forEach((q,i)=>{
    if(q.type==="who"||q.type==="nameUser"||q.type==="namePartner") return;
    max += Math.max(...q.options.map(o=>o.score||0));
    sum += (answers[i]?.score||0);
  });
  const pct = Math.round((sum/max)*100);

  const u = userName ? `<strong>${escapeHtml(userName)}</strong>` : "Você";
  const p = partnerName ? `<strong>${escapeHtml(partnerName)}</strong>` : `seu/sua ${who}`;

  let tag="Baixo", cls="low",
      text=`${u}, os sinais percebidos com ${p} estão baixos. Conversem com exemplos específicos e alinhem expectativas.`;
  if(pct>=35 && pct<70){
    tag="Moderado"; cls="mid";
    text=`${u}, há alguns sinais a observar com ${p}. Crie espaço para diálogo honesto e alinhem expectativas.`;
  }
  if(pct>=70){
    tag="Alto"; cls="high";
    text=`${u}, os sinais percebidos envolvendo ${p} estão altos. Antes de decisões impulsivas, busque uma conversa estruturada e, se possível, apoio profissional.`;
  }

  rezTag.className="tag "+cls; rezTag.textContent=tag; 
  rezText.innerHTML = text;  // mantém os nomes em negrito

  // anima a barra de intensidade conforme pct
  fill.style.width = "0%";
  requestAnimationFrame(()=>{ setTimeout(()=>{ fill.style.width = pct + "%"; }, 40); });

  stage.innerHTML=""; 
  result.style.display="grid"; 
  bar.style.width="100%";
}

/* ===== CTA ===== */
document.getElementById('ctaApp').addEventListener('click', ()=>{
  if(APP_URL && APP_URL.trim()){ window.location.href = APP_URL; }
});

document.addEventListener('DOMContentLoaded', render);
</script>
</body>
</html>
